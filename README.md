# TutorialGen - 画面録画から説明動画を自動生成

操作動画をアップロードするだけで、AIが自動で手順を解析し、スライドと音声付きの解説動画を数分で作成できるWebアプリケーションです。

## 主な機能

### 1. 動画アップロードとフレーム抽出
- MP4/MOV形式の画面録画をアップロード
- OpenCVによるフレーム間差分検知
- 重要な操作手順を自動でキーフレームとして抽出

### 2. AI画像解析とステップ構造化
- LLM（GPT-4o）による画像解析
- 各フレームから以下の情報を自動生成：
  - ステップタイトル
  - 操作説明
  - 詳細な説明
  - 音声ナレーション原稿

### 3. ステップ編集機能
- 抽出されたステップのテキスト編集
- ステップの並べ替え
- ステップの削除

### 4. スライド生成
- PowerPoint（PPTX）形式でスライドを自動生成
- 各スライドには以下が含まれます：
  - ステップ番号とタイトル
  - 操作画面のスクリーンショット
  - 操作説明と詳細説明
  - スピーカーノート（ナレーション原稿）

### 5. 音声合成と動画生成
- テキスト読み上げ（TTS）による音声生成
- FFmpegによる静止画と音声の合成
- 最終的な解説動画（MP4）の出力

## 技術スタック

### フロントエンド
- React 19
- Tailwind CSS 4
- shadcn/ui
- tRPC
- Wouter（ルーティング）

### バックエンド
- Node.js + Express
- tRPC 11
- Drizzle ORM
- MySQL/TiDB

### 画像・動画処理
- OpenCV（Python）
- FFmpeg
- PptxGenJS

### AI・機械学習
- GPT-4o（画像解析）
- マルチLLMプロバイダー統合（OpenAI/Gemini/Claude）

### インフラ
- ローカルファイルシステム（ファイルストレージ）
- OAuth 2.0（認証）

## プロジェクト構造

```
screen_to_tutorial/
├── client/                 # フロントエンドコード
│   ├── src/
│   │   ├── pages/         # ページコンポーネント
│   │   ├── components/    # 再利用可能なUIコンポーネント
│   │   └── lib/           # tRPCクライアント等
├── server/                # バックエンドコード
│   ├── routers.ts         # tRPCルーター
│   ├── db.ts              # データベースクエリヘルパー
│   ├── videoProcessor.ts  # 動画処理エンジン
│   ├── stepGenerator.ts   # AIステップ生成
│   ├── slideGenerator.ts  # スライド生成
│   └── videoGenerator.ts  # 動画・音声生成
├── drizzle/               # データベーススキーマ
│   └── schema.ts
├── scripts/               # Pythonスクリプト
│   └── extract_frames.py  # フレーム抽出スクリプト
└── todo.md                # 開発タスク管理
```

## データベーススキーマ

### users
ユーザー情報を管理

### projects
動画処理プロジェクトを管理
- タイトル、説明
- 動画URL、ステータス

### frames
抽出されたキーフレームを管理
- フレーム番号、タイムスタンプ
- 画像URL、差分スコア

### steps
AI生成されたステップ情報を管理
- タイトル、操作、説明、ナレーション
- 音声URL

## 開発状況

現在の実装状況については、`todo.md`を参照してください。

## 使用方法

### 1. プロジェクト作成
1. ダッシュボードから「新規プロジェクト」をクリック
2. タイトルと説明を入力
3. 動画ファイル（MP4/MOV）をアップロード

### 2. 動画処理
1. アップロード完了後、自動でフレーム抽出が開始されます
2. 処理が完了すると、「フレーム」タブに抽出された画像が表示されます

### 3. ステップ生成
1. 「ステップ」タブに移動
2. 「AIでステップを生成」ボタンをクリック
3. AIが各フレームを解析し、ステップ情報を自動生成します

### 4. 編集
1. 生成されたステップの「編集」ボタンをクリック
2. タイトル、操作、説明、ナレーションを修正できます
3. 不要なステップは「削除」ボタンで削除できます

### 5. エクスポート
- **スライド**: 「スライドをダウンロード」ボタンでPPTXファイルをダウンロード
- **動画**: 「動画をダウンロード」ボタンで音声付き解説動画（MP4）をダウンロード

## デプロイ

デプロイの詳細については、[DEPLOYMENT.md](./DEPLOYMENT.md) を参照してください。

### クイックスタート

```bash
# 依存関係をインストール
npm install --legacy-peer-deps

# ビルド（マイグレーションを含む）
npm run build

# サーバー起動
npm start
```

### 必須環境変数

```env
DATABASE_URL=mysql://user:password@host:3306/database
JWT_SECRET=your-very-long-secret-key-at-least-32-chars
AUTH_MODE=none
OAUTH_SERVER_URL=https://oauth.example.com
LLM_PROVIDER=openai
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxx
TTS_PROVIDER=openai
```

## セキュリティ機能

- **認証**: OAuth 2.0 + JWT による認証
- **所有者チェック**: 全APIエンドポイントでリソースの所有者検証
- **レート制限**: Token Bucket アルゴリズムによるAPI制限
- **入力検証**: Zod スキーマによる厳密な入力検証
- **エラーサニタイズ**: センシティブ情報の除去

## 実装済み機能

- ✅ 動画アップロード（Base64エンコード、進捗表示付き）
- ✅ フレーム抽出（OpenCV）
- ✅ AIステップ生成（GPT-4o）
- ✅ TTS音声合成（OpenAI TTS API）
- ✅ スライド生成（PowerPoint）
- ✅ 動画生成（FFmpeg）
- ✅ ダウンロード機能（スライド/動画）
- ✅ プロジェクト検索・フィルタリング
- ✅ 一括削除機能
- ✅ プロジェクト複製
- ✅ 削除取り消し（30秒以内）
- ✅ 処理の再試行（パラメータ調整可能）
- ✅ レート制限

## 今後の改善点

1. **マルチパートアップロード対応**
   - 大容量ファイルの効率的なアップロード
   - アップロード再開機能

2. **ステップの並べ替え機能**
   - ドラッグ&ドロップによる並べ替え
   - sortOrderの自動更新

3. **画像の差し替え機能**
   - 手動で画像をアップロードして差し替え
   - フレームの再抽出

4. **エクスポート設定**
   - スライドテンプレートの選択
   - 動画解像度・フォーマットの設定

5. **バッチ処理**
   - 複数の動画を一括処理
   - プロジェクトのテンプレート化

## ライセンス

MIT
