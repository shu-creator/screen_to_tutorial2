# Screen Recording Tutorial Generator - TODO

## Phase 1: プロジェクト計画とtodo.md作成
- [x] プロジェクト初期化
- [x] todo.md作成

## Phase 2: データベーススキーマとバックエンド基盤の構築
- [x] データベーススキーマ設計（projects, frames, steps テーブル）
- [x] S3ストレージ連携設定
- [x] tRPCルーター基本構造の実装

## Phase 3: 動画アップロードとフレーム抽出エンジンの実装
- [x] 動画ファイルアップロードAPI実装
- [x] OpenCV環境のセットアップ
- [x] 動画からフレーム抽出スクリプト実装
- [x] フレーム間差分検知アルゴリズム実装
- [x] キーフレーム自動検出ロジック実装
- [x] 抽出フレームのS3保存機能

## Phase 4: AI画像解析とステップ構造化機能の実装
- [x] LLM統合（画像解析用）
- [x] 画像からステップ情報抽出ロジック
- [x] JSON構造化処理
- [x] ステップデータのDB保存

## Phase 5: フロントエンドUIの実装（アップロード・一覧・編集）
- [x] デザインスタイル決定とテーマ設定
- [x] ダッシュボードレイアウト構築
- [x] 動画アップロードページ実装
- [x] プロジェクト一覧ページ実装
- [x] フレーム一覧表示UI実装
- [x] ステップ編集UI実装（テキスト修正・並べ替え・画像差し替え）

## Phase 6: スライド生成機能の実装
- [x] PowerPoint生成ライブラリ選定とインストール
- [x] スライドテンプレート設計
- [x] ステップデータからPPTX生成ロジック実装
- [x] スライドダウンロード機能

## Phase 7: 音声合成と動画生成機能の実装
- [x] TTS（テキスト読み上げ）API統合
- [x] ナレーション音声生成機能
- [x] FFmpeg環境セットアップ
- [x] 静止画と音声の動画合成ロジック実装
- [x] 最終動画（MP4）出力機能

## Phase 8: 統合テストとチェックポイント作成
- [x] エンドツーエンドテスト実施
- [x] Vitestユニットテスト作成
- [x] バグ修正
- [x] チェックポイント作成

## Phase 9: 開発成果の提示とデモンストレーション
- [x] デモ動画準備
- [x] ユーザーへの成果物提示
- [x] 次ステップの提案

## Phase 10: 動画アップロード機能の完全実装
- [x] フロントエンドの動画アップロードUI実装
- [x] ファイルサイズ制限とバリデーション
- [x] アップロード進捗表示
- [x] バックエンドのマルチパートファイル受信実装
- [x] S3へのファイルアップロード処理
- [x] 動画処理のバックグラウンド実行

## Phase 11: スライドと動画生成機能のUI統合
- [x] プロジェクト詳細ページにスライド生成ボタン追加
- [x] プロジェクト詳細ページに動画生成ボタン追加
- [x] 生成中のローディング状態表示
- [x] 生成完了後のダウンロードリンク表示

## Phase 12: 最終テストとチェックポイント
- [x] エンドツーエンドテスト実施
- [x] バグ修正
- [x] 最終チェックポイント作成

## バグ修正: ログイン後にトップページにリダイレクトされる問題
- [x] 認証フローの問題調査
- [x] DashboardLayoutコンポーネントの認証チェック修正
- [x] ルーティングロジックの修正
- [x] 修正のテストと動作確認

## バグ修正: DashboardLayoutメニュー項目の再修正（GitHub同期後）
- [x] DashboardLayout.tsxのmenuItems配列を修正
- [x] 不要なメニュー項目（Page 1, Page 2）を削除
- [x] プロジェクト一覧へのナビゲーションを実装
- [x] ブラウザでの動作確認
- [x] チェックポイント作成とGitHubへのプッシュ

## バグ修正: 動画アップロード機能のサーバーサイド実装完成
- [x] NewProject.tsxの実装を確認
- [x] ファイルアップロードのフロントエンド処理を実装
- [x] バックエンドのファイル受信処理を実装
- [x] S3へのアップロードとDB保存処理を実装
- [x] 動画処理パイプラインの実行
- [x] エラーハンドリングとユーザーフィードバック
- [x] 実際の動画ファイルでテスト

## GitHubマージコンフリクト解決
- [x] GitHubの変更をマージ
- [x] 500MB制限を維持
- [x] ファイル形式チェックを追加
- [x] GitHubの実装スタイルを採用（videoBase64/fileName/contentType）
- [x] 開発サーバー再起動
- [x] チェックポイント作成

## サーバーサイドロジックの単体テスト
- [x] テスト用動画のダウンロードまたは生成
- [x] フレーム抽出スクリプトの実行テスト
- [x] AI解析とステップ生成のテスト
- [x] スライド生成ロジックのテスト
- [x] 生成されたファイルの検証
- [x] 問題点の特定と修正
- [x] テスト結果レポート作成

## サーバーサイドロジック単体テスト完了

すべてのテストが成功しました：
- ✅ フレーム抽出: 正常動作
- ✅ AI解析: 正常動作
- ✅ スライド生成: 正常動作
- ✅ リクエストボディサイズ制限: 50MBに設定済み

詳細は `test_results_report.md` を参照してください。

## 動画処理の進捗状況リアルタイム表示機能

- [x] データベーススキーマに進捗状況フィールドを追加（processingProgress, processingMessage）
- [x] サーバーサイドの進捗管理機能を実装（updateProjectProgress関数）
- [x] videoProcessor.tsで各処理ステップごとに進捗を更新
- [x] stepGenerator.tsでAI解析ステップごとに進捗を更新
- [x] tRPCエンドポイントで進捗取得API（getProgress）を追加
- [x] フロントエンドに進捗表示UI（プログレスバー、ステータスメッセージ）を実装
- [x] ポーリング機能を実装（1秒間隔、処理完了時に自動停止）
- [x] 動作確認とテスト（progress.test.tsで全テスト成功）

## 動画処理失敗時の具体的なエラー通知機能

- [x] データベーススキーマにerrorMessageフィールドを追加
- [x] db.tsにエラーメッセージ保存関数を追加（updateProjectError）
- [x] videoProcessor.tsでエラーをキャッチし、具体的なエラーメッセージを生成
- [x] stepGenerator.tsでエラーをキャッチし、具体的なエラーメッセージを生成（generateErrorMessage関数）
- [x] routers.tsでエラーハンドリングを強化し、エラーメッセージをDBに保存
- [x] project.getProgressエンドポイントでerrorMessageを返すように修正
- [x] フロントエンドのプロジェクト一覧ページにエラーメッセージ表示を追加
- [x] フロントエンドのプロジェクト詳細ページにエラーメッセージ表示を追加
- [x] 動作確認とテスト（error.test.tsで全テスト成功）

## 動画アップロード後のOpenCVエラー修正

- [ ] サーバーログとエラー詳細を調査
- [ ] Python環境とOpenCVのインストール状況を確認
- [ ] フレーム抽出スクリプトの実行環境を修正
- [ ] 動画アップロードで再テスト

## NumPyとPython 3.13の互換性問題修正

- [x] Python環境とNumPyのバージョンを確認（Python 3.11, NumPy 2.4.1）
- [x] NumPyを再インストール（--force-reinstallで破損を修復）
- [x] requirements.txtを作成（numpy>=2.4.0, opencv-python-headless>=4.8.0）
- [ ] 動画アップロードで動作確認

## 解説動画の音声追加とスライドプレビュー改善

- [x] 解説動画に音声が含まれない原因を調査（Manus Forge APIがTTS未対応）
- [ ] TTS APIの代替案を実装（OpenAI API直接呼び出しまたは別のTTSサービス）
- [x] スライドプレビューの画像サイズを拡大（パディング削除、w-full h-fullに変更）
- [ ] 動作確認とテスト

## OpenAI API直接呼び出しでTTS機能を実装

- [x] OPENAI_API_KEYの入力をユーザーに依頼（webdev_request_secretsで完了）
- [x] ENV設定にOPENAI_API_KEYを追加（env.tsに追加）
- [x] TTS実装をOpenAI API直接呼び出しに変更（generateSpeechWithOpenAI関数追加）
- [x] フォールバック機能を実装（OpenAI → Manus Forge → 無音）
- [x] 動作確認とテスト（tts.test.tsでテスト成功）

## Responses API移行によるステップ生成の不具合修正

- [x] LLM APIのペイロードフォーマットを確認（Responses API形式が正しいか）
- [x] ステップ生成のAI解析が正常に動作するか確認
- [x] 必要に応じてChat Completions APIに戻す
- [x] 動作確認とテスト

## スライド生成の失敗を修正

- [x] サーバーログでエラーメッセージを確認
- [x] slideGenerator.tsのコードを確認
- [x] PptxGenJSのインポート問題を修正（動的インポートを使用）
- [x] スライド生成が成功することを確認
- [x] CORS問題によるダウンロードエラーを修正

## スライドデザインの改善

- [x] 現在のスライドレイアウトを確認
- [x] 2カラムレイアウトに変更（左：画像、右：説明）
- [x] 画像サイズを縮小（w: 9.0 → 5.0, h: 5.0 → 5.5）
- [x] 説明文を右側に配置し、フォントサイズを大きく
- [x] アイコンを追加して視認性を向上
- [x] 改善されたスライドをテスト

## P0: スライドレイアウトの根本的な問題を修正

- [x] レイアウトのはみ出しをゼロにする（画像、右パネル、テキスト枠）
- [x] テキストの行数制限を実装（タイトル24文字、操作34文字、詳細60文字）
- [x] 画像のアスペクト比をcontainに統一し、常に同じ挙動にする
- [x] スライドの高さ制約を守る計算式を実装
- [x] 改善されたスライドをテスト
